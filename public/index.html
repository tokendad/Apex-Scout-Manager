<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Apex Scout Manager</title>
    <link rel="stylesheet" href="styles.css?v=15">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="container">
        <header>
            <button id="mobileMenuBtn" class="mobile-menu-btn" title="Menu">
                <span class="hamburger-icon"><i data-lucide="menu"></i></span>
            </button>
            <h1>Apex Scout Manager</h1>
            <button id="invitationsBtn" class="invitations-btn" title="Pending Invitations" onclick="openInvitationsModal()" style="display: none;">
                <span class="invite-icon"><i data-lucide="mail"></i></span>
                <span id="invitationBadge" class="notification-badge">0</span>
            </button>
        </header>

        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <nav class="tab-nav">
            <button class="tab-btn active" data-view="profile">
                <span class="tab-icon"><i data-lucide="user"></i></span>
                <span class="tab-label">Profile</span>
            </button>
            <button class="tab-btn" data-view="cookies" id="cookiesTab">
                <span class="tab-icon"><i data-lucide="cookie"></i></span>
                <span class="tab-label" id="cookiesTabLabel">Cookies</span>
            </button>
            <button class="tab-btn" data-view="events">
                <span class="tab-icon"><i data-lucide="calendar"></i></span>
                <span class="tab-label">Calendar</span>
            </button>
            <button class="tab-btn" data-view="settings">
                <span class="tab-icon"><i data-lucide="settings"></i></span>
                <span class="tab-label">Settings</span>
            </button>
            <button class="tab-btn" data-view="troopLeader" id="troopLeaderTab" style="display: none;">
                <span class="tab-icon"><i data-lucide="users"></i></span>
                <span class="tab-label">Troop</span>
            </button>
            <button class="tab-btn" data-view="council" id="councilTab" style="display: none;">
                <span class="tab-icon"><i data-lucide="landmark"></i></span>
                <span class="tab-label">Council</span>
            </button>
            <div class="sidebar-divider"></div>
            <button id="logoutBtn" class="tab-btn logout-btn-sidebar">
                <span class="tab-icon"><i data-lucide="log-out"></i></span>
                <span class="tab-label">Logout</span>
            </button>
        </nav>

        <main>
            <!-- Profile View -->
                <!-- Add Sale Form -->
                <section class="add-sale-section">
                    
            <div id="view-profile" class="view-section">
                <section class="profile-display-section">
                    <div class="profile-card">
                        <div class="profile-photo-display">
                            <img id="profilePhotoDisplay" src="" alt="Profile Photo" class="profile-photo-large" style="display:none;">
                            <div id="profilePhotoPlaceholderDisplay" class="profile-photo-placeholder-large"><i data-lucide="user"></i></div>
                        </div>

                        <!-- Scout Level Badge (Phase 3.1) -->
                        <div id="scoutLevelBadgeContainer" class="scout-level-badge-container" style="display:none;">
                            <div id="scoutLevelBadge" class="scout-level-badge">
                                <div class="badge-content">
                                    <span id="scoutLevelName" class="badge-level-name"></span>
                                    <span id="scoutOrgName" class="badge-org-name"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Badge Achievement Dashboard (Phase 3.2 Step 6) -->
                    <div id="badgeAchievementSection" class="badge-achievement-section" style="display:none;">
                        <div class="badge-achievement-header">
                            <h3>My Badges</h3>
                            <span id="badgeEarnedCount" class="badge-count-pill">0 earned</span>
                        </div>
                        <div id="earnedBadgesStrip" class="earned-badges-strip"></div>
                        <button class="btn btn-ghost btn-sm" onclick="openBadgeGalleryModal()">Browse Available Badges</button>
                    </div>

                    <!-- Parent Dashboard (Phase 5.5) -->
                    <div id="parentDashboardSection" class="parent-dashboard-section glass-card" style="display:none; margin-top: var(--space-xl); padding: var(--space-lg); border-radius: 16px;">
                        <h3>My Scouts</h3>
                        <div id="linkedScoutsList" class="linked-scouts-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                            <p class="empty-state">No scouts linked to your account.</p>
                        </div>
                    </div>

                    <div class="qr-codes-display">
                        <div class="qr-card">
                            <h3>My Cookie Store</h3>
                            <div id="storeQrDisplay" class="qr-display-container">
                                <img id="storeQrImageDisplay" src="" alt="Store QR Code" style="display:none;">
                                <p id="storeQrPlaceholder" class="qr-placeholder">No store QR code set.<br>Add one in Settings.</p>
                            </div>
                        </div>

                        <div class="qr-card">
                            <h3>Payment Methods</h3>
                            <div id="paymentMethodsDisplay" class="qr-methods-container">
                                <p id="paymentMethodsPlaceholder" class="qr-placeholder">No payment methods set.<br>Add them in Settings.</p>
                                <!-- Payment methods will be injected here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- On-Hand Inventory Section -->
                <section class="inventory-section">
                    <h2>On-Hand Inventory</h2>
                    <p class="inventory-subtitle">Track the boxes you currently have</p>
                    <div class="inventory-grid">
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Thin Mints®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('ThinMints')">−</button>
                                <input type="number" id="inventoryThinMints" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('ThinMints')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Samoas®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Samoas')">−</button>
                                <input type="number" id="inventorySamoas" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Samoas')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Tagalongs®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Tagalongs')">−</button>
                                <input type="number" id="inventoryTagalongs" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Tagalongs')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Trefoils®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Trefoils')">−</button>
                                <input type="number" id="inventoryTrefoils" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Trefoils')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Do-si-dos®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('DosiDos')">−</button>
                                <input type="number" id="inventoryDosiDos" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('DosiDos')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Lemon-Ups®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('LemonUps')">−</button>
                                <input type="number" id="inventoryLemonUps" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('LemonUps')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Adventurefuls®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Adventurefuls')">−</button>
                                <input type="number" id="inventoryAdventurefuls" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Adventurefuls')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Exploremores™</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Exploremores')">−</button>
                                <input type="number" id="inventoryExploremores" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Exploremores')">+</button>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <span class="inventory-cookie-name">Toffee-tastic®</span>
                            <div class="inventory-controls">
                                <button class="inventory-btn" onclick="decrementInventory('Toffeetastic')">−</button>
                                <input type="number" id="inventoryToffeetastic" class="inventory-input" min="0" value="0" onchange="saveInventory()">
                                <button class="inventory-btn" onclick="incrementInventory('Toffeetastic')">+</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cookie Details Section -->
                <section class="cookie-details-section">
                    <h2>Meet the Cookies</h2>
                    <p class="cookie-price-note">All cookies are $6 per box</p>
                    <div class="cookie-grid">
                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1574458209.coreimg.png/1757342350486/meetthecookies-graphics-hybridthinmints-255x255.png" alt="Thin Mints">
                            <h3>Thin Mints®</h3>
                            <span class="cookie-badge vegan">Vegan</span>
                            <p class="cookie-description">Crisp, chocolate cookies dipped in a delicious mint chocolaty coating.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1168943426.coreimg.png/1736976066246/meetthecookies-graphics-hybridsamoascarameldelites-255x255.png" alt="Samoas">
                            <h3>Samoas®</h3>
                            <p class="cookie-alt-name">(Caramel deLites®)</p>
                            <p class="cookie-description">Crisp cookies with caramel, coconut, and chocolaty stripes.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_435681049.coreimg.png/1693315815634/meetthecookies-graphics-hybridpeanutbutterpattiestagalongs-255x255.png" alt="Tagalongs">
                            <h3>Tagalongs®</h3>
                            <p class="cookie-alt-name">(Peanut Butter Patties®)</p>
                            <span class="cookie-badge vegan">Vegan</span>
                            <p class="cookie-description">Crispy cookies layered with peanut butter and covered with a chocolaty coating.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_750886972.coreimg.png/1757342220634/meetthecookies-graphics-hybridshortbreadtrefoils-255x255.png" alt="Trefoils">
                            <h3>Trefoils®</h3>
                            <p class="cookie-description">Iconic shortbread cookies inspired by the original recipe.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1034315555.coreimg.png/1736976132377/meetthecookies-graphics-hybridpeanutbuttersandwichdosidos-255x255.png" alt="Do-si-dos">
                            <h3>Do-si-dos®</h3>
                            <p class="cookie-alt-name">(Peanut Butter Sandwich)</p>
                            <p class="cookie-description">Crunchy oatmeal sandwich cookies with peanut butter filling.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1787644668.coreimg.png/1757342264367/meetthecookies-graphics-lbblemonups-255x255.png" alt="Lemon-Ups">
                            <h3>Lemon-Ups®</h3>
                            <p class="cookie-description">Crispy lemon cookies baked with inspiring messages.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage.coreimg.png/1757342369090/meetthecookies-graphics-hybridadventurefuls-255x255.png" alt="Adventurefuls">
                            <h3>Adventurefuls®</h3>
                            <p class="cookie-description">Indulgent brownie-inspired cookies topped with caramel flavored crème with a hint of sea salt.</p>
                        </div>

                        <div class="cookie-detail-card">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1402666257.coreimg.png/1757509269312/meetthecookies-exploremores-hybrid-255x255.png" alt="Exploremores">
                            <h3>Exploremores™</h3>
                            <p class="cookie-description">Sandwich cookies with chocolate, marshmallow, and almond flavored creme.</p>
                        </div>

                        <div class="cookie-detail-card cookie-gf">
                            <img class="cookie-image" src="https://www.girlscouts.org/en/cookies/cookie-flavors/_jcr_content/root/container/gridsystem_copy/par_0/textandimage_copy_1157222513.coreimg.png/1757342209646/meetthecookies-graphics-lbbtoffeetastic-255x255.png" alt="Toffee-tastic">
                            <h3>Toffee-tastic®</h3>
                            <span class="cookie-badge gluten-free">Gluten-Free</span>
                            <p class="cookie-description">Rich, buttery cookies with sweet, crunchy toffee bits.</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Cookie Dashboard View -->
            <div id="view-cookies" class="view-section hidden">
                <!-- My Sales Summary -->
                <div class="cookie-dashboard-header">
                    <h2 id="cookieDashTitle">Cookie Dashboard</h2>
                </div>

                <div class="cookie-hero-section">
                    <div class="goal-ring-container">
                        <svg class="goal-ring" viewBox="0 0 100 100">
                            <circle class="goal-ring-bg" cx="50" cy="50" r="45"></circle>
                            <circle id="goalRingProgress" class="goal-ring-fill" cx="50" cy="50" r="45"></circle>
                        </svg>
                        <div class="goal-ring-text">
                            <span id="myGoalProgress" class="goal-percent">0%</span>
                            <span class="goal-label">of Goal</span>
                        </div>
                    </div>
                    <div class="hero-stats">
                        <div class="hero-stat-item">
                            <span class="hero-stat-value" id="myTotalBoxes">0</span>
                            <span class="hero-stat-label">Boxes Sold</span>
                        </div>
                        <div class="hero-stat-item">
                            <span class="hero-stat-value" id="myTotalCollected">$0</span>
                            <span class="hero-stat-label">Collected</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Sale Entry -->
                <section class="cookie-quick-sale glass-card">
                    <h3>Quick Sale</h3>
                    <form id="quickSaleForm" class="quick-sale-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="qsProduct">Product</label>
                                <select id="qsProduct" required>
                                    <option value="">Select cookie...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="qsQuantity">Qty</label>
                                <input type="number" id="qsQuantity" min="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label for="qsSaleType">Type</label>
                                <select id="qsSaleType">
                                    <option value="individual_inperson">In-Person</option>
                                    <option value="individual_digital_delivered">Digital (Delivered)</option>
                                    <option value="individual_digital_shipped">Digital (Shipped)</option>
                                    <option value="individual_donation">Donation</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group flex-grow">
                                <label for="qsCustomer">Customer Name</label>
                                <input type="text" id="qsCustomer" placeholder="Optional">
                            </div>
                            <button type="submit" class="btn btn-primary">Record Sale</button>
                        </div>
                    </form>
                </section>

                <!-- Product Breakdown -->
                <section class="cookie-product-breakdown glass-card">
                    <h3>Sales by Product</h3>
                    <div id="cookieProductBreakdown" class="cookie-product-grid">
                        <p class="empty-state">No sales recorded yet</p>
                    </div>
                </section>

                <!-- My Inventory -->
                <section class="cookie-inventory-section glass-card">
                    <h3>My Inventory</h3>
                    <div id="cookieInventoryGrid" class="cookie-inventory-grid">
                        <p class="empty-state">No inventory tracked yet</p>
                    </div>
                </section>

                <!-- Recent Sales -->
                <section class="cookie-recent-sales glass-card">
                    <h3>Recent Sales</h3>
                    <div id="cookieRecentSales" class="recent-sales-list">
                        <p class="empty-state">No recent sales</p>
                    </div>
                </section>

                <!-- Goal Getter Order Card -->
                <section class="cookie-order-card glass-card">
                    <div class="section-header">
                        <h3>Goal Getter Order Card</h3>
                        <button class="btn btn-secondary btn-sm" onclick="toggleOrderCard()">Open Order Card</button>
                    </div>
                    <div id="orderCardContainer" class="order-card-container hidden">
                        <div class="order-card-header">
                            <div class="order-card-info">
                                <span id="orderCardScoutName" class="order-card-scout"></span>
                                <span id="orderCardTroop" class="order-card-troop"></span>
                                <span id="orderCardGoal" class="order-card-goal"></span>
                            </div>
                            <div class="order-card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="printOrderCard()">Print</button>
                                <button class="btn btn-sm btn-primary" onclick="saveOrderCard()">Save All</button>
                            </div>
                        </div>
                        <div class="order-card-table-wrapper">
                            <table class="order-card-table" id="orderCardTable">
                                <thead id="orderCardHead">
                                    <tr><th>Customer</th><th>Phone</th></tr>
                                </thead>
                                <tbody id="orderCardBody">
                                </tbody>
                                <tfoot id="orderCardFoot">
                                    <tr><td colspan="2"><strong>Totals</strong></td></tr>
                                </tfoot>
                            </table>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="addOrderCardRow()">+ Add Customer</button>
                    </div>
                </section>

                <!-- Troop Summary (shown with view_troop_sales privilege) -->
                <section id="cookieTroopSection" class="cookie-troop-section glass-card" style="display:none;">
                    <h3>Troop Overview</h3>
                    <div class="cookie-troop-cards">
                        <div class="summary-card">
                            <span class="summary-icon"><i data-lucide="package"></i></span>
                            <div class="summary-data">
                                <span class="summary-value" id="cookieTroopBoxes">0</span>
                                <span class="summary-label">Troop Boxes</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <span class="summary-icon"><i data-lucide="dollar-sign"></i></span>
                            <div class="summary-data">
                                <span class="summary-value" id="cookieTroopCollected">$0</span>
                                <span class="summary-label">Troop Collected</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <span class="summary-icon"><i data-lucide="wallet"></i></span>
                            <div class="summary-data">
                                <span class="summary-value" id="cookieTroopProceeds">$0</span>
                                <span class="summary-label">Est. Proceeds</span>
                            </div>
                        </div>
                    </div>

                    <!-- Season Milestones -->
                    <div class="cookie-milestones">
                        <h4>Season Milestones</h4>
                        <div id="cookieMilestonesList" class="milestones-list">
                            <p class="empty-state">No milestones set</p>
                        </div>
                    </div>
                </section>

                <!-- Booth Events (shown with view_events privilege) -->
                <section id="cookieBoothSection" class="cookie-booth-section glass-card" style="display:none;">
                    <div class="section-header">
                        <h3>Booth Events</h3>
                        <button class="btn btn-primary btn-sm" onclick="openCreateBoothModal()">+ New Booth</button>
                    </div>
                    <div id="boothEventsList" class="booth-events-list">
                        <p class="empty-state">No booth events scheduled</p>
                    </div>
                </section>
            </div>

            <!-- Create Booth Modal -->
            <div id="createBoothModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>New Booth Event</h3>
                        <button class="modal-close" onclick="closeCreateBoothModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="boothEventName">Event Name *</label>
                            <input type="text" id="boothEventName" placeholder="e.g., Walmart Cookie Booth" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boothEventType">Booth Type</label>
                                <select id="boothEventType">
                                    <option value="troop">Troop Booth (2-5 girls)</option>
                                    <option value="family">Family Booth (1 girl)</option>
                                    <option value="council">Council Booth</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="boothStartingBank">Starting Bank ($)</label>
                                <input type="number" id="boothStartingBank" min="0" step="0.01" value="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="boothLocation">Location</label>
                            <input type="text" id="boothLocation" placeholder="e.g., Walmart #1234">
                        </div>
                        <div class="form-group">
                            <label for="boothLocationAddress">Address</label>
                            <input type="text" id="boothLocationAddress" placeholder="Street address">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boothStartDate">Start Date/Time *</label>
                                <input type="datetime-local" id="boothStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="boothEndDate">End Date/Time *</label>
                                <input type="datetime-local" id="boothEndDate" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="boothNotes">Notes</label>
                            <textarea id="boothNotes" rows="2" placeholder="Optional notes"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCreateBoothModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="createBoothEvent()">Create Booth</button>
                    </div>
                </div>
            </div>

            <!-- Create Fulfillment Order Modal -->
            <div id="createFulfillmentModal" class="modal" style="display:none;">
                <div class="modal-content modal-lg">
                    <div class="modal-header">
                        <h3>New Council Order</h3>
                        <button class="modal-close" onclick="closeCreateFulfillmentModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="fulfillmentItemsList" class="booth-inventory-grid-field">
                            <!-- Items injected by JS -->
                        </div>
                        <div class="form-group" style="margin-top: var(--space-lg);">
                            <label for="fulfillmentNotes">Notes</label>
                            <textarea id="fulfillmentNotes" rows="2" placeholder="Optional notes"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCreateFulfillmentModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitFulfillmentOrder()">Place Order</button>
                    </div>
                </div>
            </div>

            <!-- Booth Detail Modal -->
            <div id="boothDetailModal" class="modal" style="display:none;">
                <div class="modal-content modal-lg">
                    <div class="modal-header">
                        <h3 id="boothDetailTitle">Booth Details</h3>
                        <button class="modal-close" onclick="closeBoothDetailModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="booth-detail-status">
                            <span id="boothDetailStatus" class="booth-status-badge">Planning</span>
                            <div class="booth-detail-actions" id="boothDetailActions"></div>
                        </div>

                        <div class="booth-detail-tabs">
                            <button class="booth-tab active" data-booth-tab="info" onclick="switchBoothTab('info')">Info</button>
                            <button class="booth-tab" data-booth-tab="shifts" onclick="switchBoothTab('shifts')">Shifts</button>
                            <button class="booth-tab" data-booth-tab="inventory" onclick="switchBoothTab('inventory')">Inventory</button>
                            <button class="booth-tab" data-booth-tab="payments" onclick="switchBoothTab('payments')">Payments</button>
                            <button class="booth-tab" data-booth-tab="reconcile" onclick="switchBoothTab('reconcile')">Reconcile</button>
                        </div>

                        <!-- Info Tab -->
                        <div id="booth-panel-info" class="booth-panel">
                            <div id="boothDetailInfo"></div>
                        </div>

                        <!-- Shifts Tab -->
                        <div id="booth-panel-shifts" class="booth-panel hidden">
                            <div class="section-header">
                                <h4>Shift Schedule</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openAddShiftForm()">+ Add Shift</button>
                            </div>
                            <div id="addShiftForm" class="add-shift-form hidden">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Scout</label>
                                        <select id="shiftScoutSelect"></select>
                                    </div>
                                    <div class="form-group">
                                        <label>Start</label>
                                        <input type="datetime-local" id="shiftStartTime">
                                    </div>
                                    <div class="form-group">
                                        <label>End</label>
                                        <input type="datetime-local" id="shiftEndTime">
                                    </div>
                                    <button class="btn btn-sm btn-primary" onclick="addShift()">Add</button>
                                </div>
                            </div>
                            <div id="boothShiftsList" class="shifts-list">
                                <p class="empty-state">No shifts scheduled</p>
                            </div>
                        </div>

                        <!-- Inventory Tab -->
                        <div id="booth-panel-inventory" class="booth-panel hidden">
                            <div class="section-header">
                                <h4>Booth Inventory</h4>
                                <button class="btn btn-sm btn-secondary" onclick="setupBoothInventory()">Setup Inventory</button>
                            </div>
                            <div id="boothInventoryTable" class="booth-inventory-grid">
                                <p class="empty-state">No inventory set up</p>
                            </div>
                            <button id="saveBoothInventoryBtn" class="btn btn-primary" style="display:none;" onclick="saveBoothInventory()">Save Inventory</button>
                            <button id="recordEndCountBtn" class="btn btn-secondary" style="display:none;" onclick="recordEndingCount()">Record Ending Count</button>
                        </div>

                        <!-- Payments Tab -->
                        <div id="booth-panel-payments" class="booth-panel hidden">
                            <div class="section-header">
                                <h4>Payments</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openAddPaymentForm()">+ Add Payment</button>
                            </div>
                            <div id="addPaymentForm" class="add-payment-form hidden">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Type</label>
                                        <select id="paymentTypeSelect">
                                            <option value="cash">Cash</option>
                                            <option value="check">Check</option>
                                            <option value="venmo">Venmo</option>
                                            <option value="paypal">PayPal</option>
                                            <option value="square">Square</option>
                                            <option value="zelle">Zelle</option>
                                            <option value="digital_cookie">Digital Cookie</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Amount ($)</label>
                                        <input type="number" id="paymentAmount" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label>Reference #</label>
                                        <input type="text" id="paymentReference" placeholder="Optional">
                                    </div>
                                    <button class="btn btn-sm btn-primary" onclick="addPayment()">Add</button>
                                </div>
                            </div>
                            <div id="boothPaymentsList" class="payments-list">
                                <p class="empty-state">No payments recorded</p>
                            </div>
                        </div>

                        <!-- Reconciliation Tab -->
                        <div id="booth-panel-reconcile" class="booth-panel hidden">
                            <div id="reconciliationSummary" class="reconciliation-summary">
                                <p class="empty-state">Complete inventory count and payment entry to reconcile</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events View -->
            <div id="view-events" class="view-section hidden">
                <div class="calendar-controls-header">
                    <h2>Calendar</h2>
                    <div class="calendar-actions">
                        <button class="btn btn-secondary" onclick="exportCalendar()">Export .ics</button>
                        <button class="btn btn-primary" onclick="toggleAddEventForm()">+ Add Event</button>
                    </div>
                </div>

                <!-- Add Event Form (Hidden by default) -->
                <section id="addEventSection" class="add-event-section hidden">
                    <h3>Record Event</h3>
                    <form id="eventForm">
                        <div class="form-section">
                            <div class="form-group">
                                <label for="eventName">Event Name *</label>
                                <input type="text" id="eventName" placeholder="e.g., Pack Meeting" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventDate">Date *</label>
                                    <input type="date" id="eventDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="eventType">Type</label>
                                    <select id="eventType">
                                        <option value="event">General</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="booth">Booth</option>
                                        <option value="outing">Outing</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventStartTime">Start Time</label>
                                    <input type="time" id="eventStartTime">
                                </div>
                                <div class="form-group">
                                    <label for="eventEndTime">End Time</label>
                                    <input type="time" id="eventEndTime">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eventLocation">Location</label>
                                    <input type="text" id="eventLocation" placeholder="Location">
                                </div>
                                <div class="form-group">
                                    <label for="targetGroup">Group</label>
                                    <select id="targetGroup">
                                        <option value="Troop">Whole Troop/Pack</option>
                                        <option value="Lion">Lion</option>
                                        <option value="Tiger">Tiger</option>
                                        <option value="Wolf">Wolf</option>
                                        <option value="Bear">Bear</option>
                                        <option value="Webelos">Webelos</option>
                                        <option value="AOL">AOL</option>
                                        <option value="Daisy">Daisy</option>
                                        <option value="Brownie">Brownie</option>
                                        <option value="Junior">Junior</option>
                                        <option value="Cadette">Cadette</option>
                                        <option value="Senior">Senior</option>
                                        <option value="Ambassador">Ambassador</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="eventDescription">Description</label>
                                <input type="text" id="eventDescription" placeholder="Optional description">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-large">Save Event</button>
                    </form>
                </section>

                <!-- Filters -->
                <div class="calendar-filter-bar">
                    <span class="filter-label">Show:</span>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Troop" checked> Pack/Troop</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Lion" checked> Lion</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Tiger" checked> Tiger</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Wolf" checked> Wolf</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Bear" checked> Bear</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Webelos" checked> Webelos</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="AOL" checked> AOL</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Daisy" checked> Daisy</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Brownie" checked> Brownie</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Junior" checked> Junior</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Cadette" checked> Cadette</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Senior" checked> Senior</label>
                    <label class="filter-checkbox"><input type="checkbox" class="event-filter" value="Ambassador" checked> Ambassador</label>
                </div>

                <!-- Calendar -->
                <section class="calendar-section">
                    <div class="calendar-header">
                        <div class="calendar-nav-group">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">&lt;</button>
                            <h3 id="calendarMonthYear">Month Year</h3>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">&gt;</button>
                        </div>
                        <button class="calendar-today-btn" onclick="goToToday()">Today</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Days generated by JS -->
                    </div>
                </section>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view-section hidden">
                <section class="settings-section">
                    <h2>Settings</h2>

                    <!-- Payment Methods -->
                    <div class="settings-group">
                        <h3>Payment Methods</h3>
                        <p class="settings-description">Add your digital payment links so customers can pay online.</p>
                        <div id="settingsPaymentMethodsList" class="payment-methods-list">
                            <p class="empty-message">No payment methods added yet.</p>
                        </div>
                        <div class="add-payment-method">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPaymentName">Method Name</label>
                                    <input type="text" id="newPaymentName" placeholder="e.g., Venmo">
                                </div>
                                <div class="form-group">
                                    <label for="newPaymentUrl">Payment URL</label>
                                    <input type="url" id="newPaymentUrl" placeholder="e.g., https://venmo.com/yourname">
                                </div>
                            </div>
                            <button id="addPaymentMethodBtn" class="btn btn-secondary">Add Payment Method</button>
                        </div>
                    </div>

                </section>
            </div>

            <!-- Council View -->
            <div id="view-council" class="view-section hidden">
                <section class="council-section">
                    <h2>Council Administration</h2>
                    <p class="section-description">Manage troops across your council. More features coming in a future phase.</p>

                    <div class="council-actions">
                        <div class="council-card">
                            <h3>Troop Management</h3>
                            <p>Create and manage troops within your council.</p>
                            <button id="createTroopBtn" class="btn btn-primary">+ New Troop</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Troop Leader View -->
            <div id="view-troopLeader" class="view-section hidden">
                <section class="troop-section">
                    <div class="troop-header">
                        <h2>Troop Selection</h2>
                        <div class="troop-controls">
                            <select id="troopSelector" class="troop-select">
                                <option value="">Select a troop...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Troop Top Navigation -->
                    <div class="troop-top-nav" role="tablist">
                        <button class="troop-tab active" data-tab="membership">Membership</button>
                        <button class="troop-tab" data-tab="dashboard">Cookies</button>
                        <button class="troop-tab" data-tab="fulfillment">Fulfillment</button>
                        <button class="troop-tab" data-tab="financials">Financials</button>
                        <button class="troop-tab" data-tab="equipment">Equipment</button>
                        <button class="troop-tab" data-tab="events">Events</button>
                        <button class="troop-tab" data-tab="media">Media</button>
                        <button class="troop-tab" data-tab="library">Library</button>
                        <button class="troop-tab" data-tab="permissions">Permissions</button>
                    </div>

                    <div id="troop-content" class="troop-content">
                        <!-- Membership Tab -->
                        <div id="troop-tab-membership" class="troop-tab-panel">
                            <h2>Membership</h2>
                            <div class="membership-actions">
                                <button id="addMemberBtnMembership" class="btn btn-primary add-member-btn" onclick="openAddMemberModal()">Add Member</button>
                                <input id="memberSearch" type="search" placeholder="Search members..." />
                            </div>

                            <!-- Membership Sub-Tab Navigation -->
                            <div class="membership-subnav" role="tablist">
                                <button class="membership-subtab active" data-sub="scout">Scout</button>
                                <button class="membership-subtab" data-sub="family">Family</button>
                                <button class="membership-subtab" data-sub="leadership">Leadership</button>
                                <button class="membership-subtab" data-sub="volunteer">Volunteer</button>
                            </div>

                            <!-- Membership Sub-Panels -->
                            <div class="membership-subpanels">
                                <div id="membership-sub-scout" class="membership-subpanel">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_scout">
                                            <tr><td colspan="5" class="empty-state">Select a troop to view members</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-family" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Last Name</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_family">
                                            <tr><td class="empty-state">Select a troop to view families</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-leadership" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_leadership">
                                            <tr><td colspan="5" class="empty-state">No leadership members</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="membership-sub-volunteer" class="membership-subpanel hidden">
                                    <table class="membership-table">
                                        <thead>
                                            <tr><th>Name</th><th>Role</th><th>Level</th><th>Status</th><th>Actions</th></tr>
                                        </thead>
                                        <tbody id="membershipTableBody_volunteer">
                                            <tr><td colspan="5" class="empty-state">No volunteers</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Tab -->
                        <div id="troop-tab-dashboard" class="troop-tab-panel hidden">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <span class="summary-icon"><i data-lucide="package"></i></span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopTotalBoxes">0</span>
                                    <span class="summary-label">Total Boxes</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <span class="summary-icon"><i data-lucide="dollar-sign"></i></span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopTotalCollected">$0</span>
                                    <span class="summary-label">Collected</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <span class="summary-icon"><i data-lucide="users"></i></span>
                                <div class="summary-data">
                                    <span class="summary-value" id="troopMemberCount">0</span>
                                    <span class="summary-label">Members</span>
                                </div>
                            </div>
                        </div>

                        <!-- Leaderboard and Goals Row -->
                        <div class="troop-dashboard-row">
                            <!-- Leaderboard -->
                            <div class="troop-leaderboard-section">
                                <div class="section-header">
                                    <h3>Top Sellers</h3>
                                    <select id="leaderboardMetric" class="metric-select" onchange="loadLeaderboard()">
                                        <option value="boxes">By Boxes</option>
                                        <option value="revenue">By Revenue</option>
                                    </select>
                                </div>
                                <div id="leaderboardList" class="leaderboard-list">
                                    <p class="empty-state">No sales data yet</p>
                                </div>
                            </div>

                            <!-- Troop Goals Progress -->
                            <div class="troop-goals-section">
                                <div class="section-header">
                                    <h3>Troop Goals</h3>
                                    <button id="addGoalBtn" class="btn btn-secondary btn-sm">+ Add Goal</button>
                                </div>
                                <div id="troopGoalsList" class="goals-list">
                                    <p class="empty-state">No goals set. Add a goal to track progress!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Member Performance Table -->
                        <div class="troop-members-section">
                            <div class="section-header">
                                <h3>Member Performance</h3>
                                <button id="addMemberBtn" class="btn btn-secondary btn-sm add-member-btn" onclick="openAddMemberModal()">+ Add Member</button>
                            </div>
                            <div class="members-table-container">
                                <table class="members-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Role</th>
                                            <th>Boxes Sold</th>
                                            <th>Collected</th>
                                            <th>Last Sale</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="troopMembersTable">
                                        <tr><td colspan="6" class="empty-state">No members yet</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Sales by Cookie Type -->
                        <div class="troop-sales-section">
                            <h3>Sales by Cookie Type</h3>
                            <div id="troopSalesByCookie" class="cookie-sales-grid">
                                <p class="empty-state">No sales data yet</p>
                            </div>
                        </div>
                        </div><!-- end troop-tab-dashboard -->

                        <!-- Fulfillment Tab -->
                        <div id="troop-tab-fulfillment" class="troop-tab-panel hidden">
                            <div class="section-header">
                                <h2>Council Orders</h2>
                                <button class="btn btn-primary btn-sm" onclick="openCreateFulfillmentModal()">+ New Order</button>
                            </div>
                            <div id="fulfillmentOrdersList" class="fulfillment-orders-list" style="margin-bottom: var(--space-xl);">
                                <p class="empty-state">No fulfillment orders placed yet.</p>
                            </div>

                            <div class="section-header">
                                <h2>Troop Shared Inventory</h2>
                            </div>
                            <div id="troopSharedInventoryList" class="cookie-inventory-grid">
                                <p class="empty-state">No shared inventory tracked yet.</p>
                            </div>
                        </div>

                        <!-- Financials placeholder -->
                        <div id="troop-tab-financials" class="troop-tab-panel hidden">
                            <h2>Financials</h2>
                            <p>Financial summary and transactions will appear here (placeholder).</p>
                        </div>

                        <!-- Equipment placeholder -->
                        <div id="troop-tab-equipment" class="troop-tab-panel hidden">
                            <h2>Equipment</h2>
                            <p>Equipment inventory and loan tracking (placeholder).</p>
                        </div>

                        <!-- Events placeholder -->
                        <div id="troop-tab-events" class="troop-tab-panel hidden">
                            <h2>Events</h2>
                            <p>Troop events and booth schedule (placeholder).</p>
                        </div>

                        <!-- Media placeholder -->
                        <div id="troop-tab-media" class="troop-tab-panel hidden">
                            <h2>Media</h2>
                            <p>Photos and uploaded files (placeholder).</p>
                        </div>

                        <!-- Library placeholder -->
                        <div id="troop-tab-library" class="troop-tab-panel hidden">
                            <h2>Library</h2>
                            <p>Document library and resources (placeholder).</p>
                        </div>

                        <!-- Permissions Tab -->
                        <div id="troop-tab-permissions" class="troop-tab-panel hidden">
                            <h2>Member Permissions</h2>
                            <p class="permissions-description">
                                Adjust what each member can do within this troop. Changes override the role defaults.<br>
                                <strong>T</strong> = Troop &nbsp; <strong>D</strong> = Den/Patrol &nbsp;
                                <strong>H</strong> = Household &nbsp; <strong>S</strong> = Self &nbsp;
                                <strong>---</strong> = None
                            </p>

                            <div class="permissions-controls">
                                <div class="form-group">
                                    <label for="permsMemberSelect">Select Member</label>
                                    <select id="permsMemberSelect">
                                        <option value="">Choose a member...</option>
                                    </select>
                                </div>
                            </div>

                            <div id="permsMatrixContainer" style="display: none;">
                                <div class="permissions-member-info" id="permsMemberInfo"></div>
                                <div class="permissions-matrix-wrapper">
                                    <table class="permissions-matrix" id="permsMatrix">
                                        <thead>
                                            <tr>
                                                <th class="priv-name-col">Privilege</th>
                                                <th class="priv-scope-col">T</th>
                                                <th class="priv-scope-col">D</th>
                                                <th class="priv-scope-col">H</th>
                                                <th class="priv-scope-col">S</th>
                                                <th class="priv-scope-col">---</th>
                                                <th class="priv-default-col">Default</th>
                                            </tr>
                                        </thead>
                                        <tbody id="permsMatrixBody"></tbody>
                                    </table>
                                </div>
                                <div class="permissions-actions">
                                    <button class="btn btn-secondary" id="resetPermsBtn">Reset All to Defaults</button>
                                    <button class="btn btn-primary" id="savePermsBtn">Save Changes</button>
                                </div>
                            </div>

                            <div id="permsEmptyState" class="empty-state">
                                <p>Select a member above to view and manage their permissions.</p>
                            </div>
                        </div>
                    </div><!-- end troop-content -->

                    <!-- Empty State (no troop selected) -->
                    <div id="troopEmptyState" class="troop-empty-state">
                        <div class="empty-state-content">
                            <span class="empty-icon"><i data-lucide="users"></i></span>
                            <h3>Welcome, Troop Leader!</h3>
                            <p>Select a troop from the dropdown above or create a new one to get started.</p>
                        </div>
                    </div>
                </section>

                <!-- Create Troop Modal -->
                <div id="createTroopModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Create New Troop</h3>
                            <button class="modal-close" onclick="closeCreateTroopModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="newTroopNumber">Troop Number *</label>
                                <input type="text" id="newTroopNumber" placeholder="e.g., 12345" required>
                            </div>
                            <div class="form-group">
                                <label for="newTroopType">Troop Type *</label>
                                <select id="newTroopType" required>
                                    <option value="">Select type...</option>
                                    <option value="daisy">Daisy (K-1)</option>
                                    <option value="brownie">Brownie (2-3)</option>
                                    <option value="junior">Junior (4-5)</option>
                                    <option value="cadette">Cadette (6-8)</option>
                                    <option value="senior">Senior (9-10)</option>
                                    <option value="ambassador">Ambassador (11-12)</option>
                                    <option value="multi-level">Multi-Level</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="newTroopMeetingLocation">Meeting Location</label>
                                <input type="text" id="newTroopMeetingLocation" placeholder="e.g., Community Center">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newTroopMeetingDay">Meeting Day</label>
                                    <select id="newTroopMeetingDay">
                                        <option value="">Select day...</option>
                                        <option value="Monday">Monday</option>
                                        <option value="Tuesday">Tuesday</option>
                                        <option value="Wednesday">Wednesday</option>
                                        <option value="Thursday">Thursday</option>
                                        <option value="Friday">Friday</option>
                                        <option value="Saturday">Saturday</option>
                                        <option value="Sunday">Sunday</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="newTroopMeetingTime">Meeting Time</label>
                                    <input type="time" id="newTroopMeetingTime">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeCreateTroopModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="createTroop()">Create Troop</button>
                        </div>
                    </div>
                </div>

                <!-- Add Member Modal -->
                <div id="addMemberModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <h3>Add Member</h3>
                            <button class="modal-close" onclick="closeAddMemberModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="addMemberForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberFirstName">First Name *</label>
                                        <input type="text" id="memberFirstName" placeholder="First name">
                                    </div>
                                    <div class="form-group">
                                        <label for="memberLastName">Last Name *</label>
                                        <input type="text" id="memberLastName" placeholder="Last name">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="memberEmail">Email</label>
                                    <input type="email" id="memberEmail" placeholder="email@example.com">
                                </div>

                                <div class="form-group">
                                    <label for="memberAddress">Address</label>
                                    <input type="text" id="memberAddress" placeholder="Street address, city, state">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberBirthdate">Birthdate</label>
                                        <input type="date" id="memberBirthdate">
                                    </div>
                                    <div class="form-group">
                                        <label for="memberDen">Den</label>
                                        <input type="text" id="memberDen" placeholder="Den name/number">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="memberFamilyInfo">Family Info</label>
                                    <textarea id="memberFamilyInfo" rows="2" placeholder="Optional family notes or contact info"></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="memberLevel">Position</label>
                                        <select id="memberLevel" onchange="onPositionChange()">
                                            <option value="">Select position...</option>
                                            <option value="Scout">Scout</option>
                                            <option value="Troop Leader">Troop Leader</option>
                                            <option value="Co-Leader">Co-Leader</option>
                                            <option value="Troop Volunteer">Troop Volunteer</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="rolesGroup">
                                        <label for="memberRoles" id="rolesLabel">Roles</label>
                                        <select id="memberRoles" multiple size="6">
                                            <!-- Options populated dynamically based on position -->
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddMemberModal()">Cancel</button>
                            <button class="btn btn-primary" id="confirmAddMemberBtn" onclick="submitAddMember()">Save</button>
                        </div>
                    </div>
                </div>

                <!-- Add Goal Modal -->
                <div id="addGoalModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add Troop Goal</h3>
                            <button class="modal-close" onclick="closeAddGoalModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="goalType">Goal Type *</label>
                                <select id="goalType" required>
                                    <option value="">Select type...</option>
                                    <option value="boxes_sold">Boxes Sold</option>
                                    <option value="revenue">Revenue ($)</option>
                                    <option value="participation">Participation (%)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="goalTarget">Target Amount *</label>
                                <input type="number" id="goalTarget" min="1" placeholder="e.g., 500">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="goalStartDate">Start Date</label>
                                    <input type="date" id="goalStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="goalEndDate">End Date</label>
                                    <input type="date" id="goalEndDate">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="goalDescription">Description</label>
                                <textarea id="goalDescription" rows="2" placeholder="Optional description..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddGoalModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="createGoal()">Create Goal</button>
                        </div>
                    </div>
                </div>

                <!-- Nutrition Info Modal -->
                <div id="nutritionModal" class="modal" style="display: none;">
                    <div class="modal-content nutrition-modal">
                        <div class="modal-header">
                            <h3 id="nutritionCookieName">Cookie Name</h3>
                            <button class="modal-close" onclick="closeNutritionModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="nutrition-facts">
                                <h4>Nutrition Facts</h4>
                                <p class="serving-size" id="nutritionServing">Serving Size: --</p>
                                <div class="nutrition-divider thick"></div>
                                <table class="nutrition-table">
                                    <tbody id="nutritionTableBody">
                                        <!-- Nutrition data injected here -->
                                    </tbody>
                                </table>
                                <div class="nutrition-divider"></div>
                                <div id="nutritionIngredients" class="ingredients">
                                    <strong>Ingredients:</strong> <span id="ingredientsList">--</span>
                                </div>
                            </div>
                            <div id="nutritionAttributes" class="nutrition-attributes">
                                <!-- Attribute badges injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invitations Modal -->
                <div id="invitationsModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Troop Invitations</h3>
                            <button class="modal-close" onclick="closeInvitationsModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="invitationsList" class="invitations-list">
                                <p class="empty-state">No pending invitations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Send Invitation Modal -->
                <div id="sendInviteModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Invite Member to Troop</h3>
                            <button class="modal-close" onclick="closeSendInviteModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="inviteEmail">Email Address *</label>
                                <input type="email" id="inviteEmail" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label for="inviteRole">Role in Troop</label>
                                <select id="inviteRole">
                                    <option value="scout">Scout</option>
                                    <option value="parent">Parent</option>
                                    <option value="co-leader">Co-Leader</option>
                                    <option value="assistant">Assistant</option>
                                    <option value="cookie_leader">Cookie Leader</option>
                                    <option value="cookie_manager">Cookie Manager (SUCM)</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeSendInviteModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="sendInvitation()">Send Invitation</button>
                        </div>
                    </div>
                </div>

                <!-- Edit Member Modal -->
                <div id="editMemberModal" class="modal" style="display: none;">
                    <div class="modal-content modal-lg" style="max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <h3>Edit Member</h3>
                            <button class="modal-close" onclick="closeEditMemberModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="editMemberForm">
                                <input type="hidden" id="editMemberId" value="">

                                <!-- Personal Information -->
                                <div class="form-section">
                                    <h4>Personal Information</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="editFirstName">First Name *</label>
                                            <input type="text" id="editFirstName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="editLastName">Last Name *</label>
                                            <input type="text" id="editLastName" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="editDateOfBirth">Date of Birth</label>
                                            <input type="date" id="editDateOfBirth">
                                            <small class="form-help" id="editMinorStatus"></small>
                                        </div>
                                        <div class="form-group">
                                            <label for="editPhotoUrl">Photo URL</label>
                                            <input type="url" id="editPhotoUrl" placeholder="https://...">
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Information -->
                                <div class="form-section">
                                    <h4>Contact Information</h4>
                                    <div class="form-group">
                                        <label for="editEmail">Email</label>
                                        <input type="email" id="editEmail">
                                        <small class="form-help">Used for login and notifications</small>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="editPhone">Phone</label>
                                            <input type="tel" id="editPhone" placeholder="(555) 123-4567">
                                        </div>
                                        <div class="form-group">
                                            <label for="editAddress">Address</label>
                                            <input type="text" id="editAddress" placeholder="123 Main St, City, ST 12345">
                                        </div>
                                    </div>
                                </div>

                                <!-- Troop Information -->
                                <div class="form-section">
                                    <h4>Troop Information</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="editRole">Role</label>
                                            <select id="editRole">
                                                <option value="member">Scout/Member</option>
                                                <option value="parent">Parent</option>
                                                <option value="volunteer">Volunteer</option>
                                                <option value="assistant">Assistant Leader</option>
                                                <option value="co-leader">Co-Leader</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="editPosition">Position</label>
                                            <input type="text" id="editPosition" placeholder="e.g., Treasurer, Scribe">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="editScoutLevel">Scout Level</label>
                                            <select id="editScoutLevel">
                                                <option value="">Not a scout</option>
                                                <option value="Daisy">Daisy</option>
                                                <option value="Brownie">Brownie</option>
                                                <option value="Junior">Junior</option>
                                                <option value="Cadette">Cadette</option>
                                                <option value="Senior">Senior</option>
                                                <option value="Ambassador">Ambassador</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="editDen">Den</label>
                                            <input type="text" id="editDen" placeholder="Den name/number">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="editLinkedParent">Linked Parent/Guardian</label>
                                        <select id="editLinkedParent">
                                            <option value="">No parent linked</option>
                                        </select>
                                        <small class="form-help">Link this scout to a parent/guardian in the troop</small>
                                    </div>
                                </div>

                                <!-- Payment Methods -->
                                <div class="form-section">
                                    <h4>Payment Methods</h4>
                                    <div id="editPaymentMethodsList"></div>
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="addPaymentMethod()">
                                        + Add Payment Method
                                    </button>
                                </div>

                                <!-- Account Actions -->
                                <div class="form-section">
                                    <h4>Account Actions</h4>
                                    <div class="action-buttons">
                                        <button type="button" class="btn btn-warning" onclick="initiatePasswordReset()">
                                            Reset Password
                                        </button>
                                        <button type="button" class="btn btn-danger" onclick="confirmDeleteAccount()">
                                            Delete Account
                                        </button>
                                    </div>
                                    <small class="form-help text-danger">
                                        Warning: Account deletion is permanent and cannot be undone.
                                    </small>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeEditMemberModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveEditMember()">Save Changes</button>
                        </div>
                    </div>
                </div>

                <!-- Delete Account Confirmation Modal -->
                <div id="deleteAccountModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Confirm Account Deletion</h3>
                            <button class="modal-close" onclick="closeDeleteAccountModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p class="text-danger">
                                <strong>Warning:</strong> This action will permanently delete this account and all associated data.
                            </p>
                            <p>The account will be deactivated immediately and fully deleted after 30 days.</p>
                            <div class="form-group">
                                <label for="deleteReason">Reason for deletion (optional)</label>
                                <textarea id="deleteReason" rows="3" placeholder="e.g., Member left troop, duplicate account, etc."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="confirmDeleteCheckbox">
                                    I understand this action is permanent
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeDeleteAccountModal()">Cancel</button>
                            <button class="btn btn-danger" onclick="executeAccountDeletion()">Delete Account</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Badge Gallery Modal (Phase 3.2 Step 4) -->
            <div id="badgeGalleryModal" class="modal" style="display:none;">
                <div class="modal-content modal-lg">
                    <div class="modal-header">
                        <h3>Badge Gallery</h3>
                        <button class="modal-close" onclick="closeBadgeGalleryModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="badge-filter-bar">
                            <button class="badge-filter-btn active" data-filter="available" onclick="filterBadges('available')">Available</button>
                            <button class="badge-filter-btn" data-filter="earned" onclick="filterBadges('earned')">Earned</button>
                            <button class="badge-filter-btn" data-filter="all" onclick="filterBadges('all')">All</button>
                            <input type="search" id="badgeSearchInput" class="badge-search-input" placeholder="Search badges..." oninput="filterBadgesBySearch(this.value)">
                        </div>
                        <div id="badgeGalleryGrid" class="badge-gallery-grid">
                            <p class="empty-state">Loading badges...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Badge Detail Modal (Phase 3.2 Step 4) -->
            <div id="badgeDetailModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="badgeDetailName">Badge Details</h3>
                        <button class="modal-close" onclick="closeBadgeDetailModal()">&times;</button>
                    </div>
                    <div class="modal-body" id="badgeDetailBody"></div>
                </div>
            </div>

            <!-- COPPA Parental Consent Modal (Phase 5.5) -->
            <div id="coppaConsentModal" class="modal" style="display:none;">
                <div class="modal-content coppa-modal-content">
                    <div class="modal-header">
                        <h3>Parental Consent Required</h3>
                        <button class="modal-close" onclick="closeCoppaConsentModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="coppa-consent-text">
                            <p><strong>Children's Online Privacy Protection Act (COPPA) Notice</strong></p>
                            <p>Apex Scout Manager collects the following information for minors under 13 years of age:</p>
                            <ul>
                                <li>First and last name</li>
                                <li>Email address (if provided)</li>
                                <li>Scout level and organization membership</li>
                                <li>Badge and achievement records</li>
                                <li>Cookie/product sales activity</li>
                                <li>Profile photo (if uploaded)</li>
                            </ul>
                            <p>This information is used solely to manage troop activities and is not shared with third parties for commercial purposes. You may request deletion of your child's data at any time by contacting your troop leader.</p>
                            <p>By providing consent below, you confirm that you are the parent or legal guardian of the minor scout, and you authorize Apex Scout Manager to collect and use the information described above on their behalf.</p>
                            <p class="coppa-ip-notice"><em>Your consent, timestamp, and IP address will be recorded for compliance purposes.</em></p>
                        </div>
                        <div class="coppa-consent-checkbox">
                            <label class="checkbox-label">
                                <input type="checkbox" id="coppaConsentCheckbox" onchange="handleCoppaCheckboxChange()">
                                <span>I am the parent or legal guardian and I consent to the collection of my child's information as described above.</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCoppaConsentModal()">Cancel</button>
                        <button id="coppaConsentSubmitBtn" class="btn btn-primary" onclick="submitCoppaConsent()" disabled>I Consent &amp; Activate Account</button>
                    </div>
                </div>
            </div>

            <!-- Award Badge Modal (Phase 3.2 Step 5) -->
            <div id="awardBadgeModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Award Badge</h3>
                        <button class="modal-close" onclick="closeAwardBadgeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p id="awardBadgeScoutName" class="award-scout-name"></p>
                        <div class="form-group">
                            <label for="awardBadgeSelect">Badge</label>
                            <select id="awardBadgeSelect" class="form-control">
                                <option value="">Select a badge...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="awardEarnedDate">Date Earned *</label>
                            <input type="date" id="awardEarnedDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="awardNotes">Notes (optional)</label>
                            <textarea id="awardNotes" class="form-control" rows="3" placeholder="e.g., completed at troop meeting..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeAwardBadgeModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="submitAwardBadge()">Award Badge</button>
                    </div>
                </div>
            </div>

        </main>

        <footer>
            <p>&copy; 2026 Apex Scout Manager</p>
        </footer>
    </div>

    <div id="boothFieldMode" class="view-section hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: var(--gray-50); overflow-y: auto; padding: 0;">
        <div class="booth-mode-header">
            <button class="btn btn-icon" onclick="exitBoothFieldMode()">
                <i data-lucide="arrow-left"></i>
            </button>
            <h3 id="boothModeTitle" class="booth-mode-title">Booth Inventory</h3>
            <button class="btn btn-primary btn-sm" onclick="saveBoothFieldMode()">
                Save
            </button>
        </div>
        <div id="boothFieldInventoryList" class="booth-inventory-grid-field">
            <!-- Items injected by JS -->
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Initialize Lucide icons
        window.addEventListener('load', () => {
            if (window.lucide) lucide.createIcons();
        });
    </script>
</body>
</html>
